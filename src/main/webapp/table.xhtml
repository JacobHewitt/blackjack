<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://xmlns.jcp.org/jsf/core" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:b="http://bootsfaces.net/ui"
      >

    <h:head>
        <link type="text/css" rel="stylesheet" href="css.css" />
        <script src="js.js" type="text/javascript" />
        <title>BlackJack</title>
    </h:head>

    <h:body>
        
        <f:metadata>
            <f:viewParam name="tableName" value="#{tableController.tableName}" />
            <f:viewAction action="#{tableController.onLoad}" />
        </f:metadata>
        
        
        <h:form id="nameForm" >
            <h2>Welcome: <h:outputText value="#{tableController.player.userName}" /></h2>
            <h:inputText id="username" value="#{tableController.player.userName}" />
            <h:commandButton value="Set Username" >
                <f:ajax execute="username" render="@form" />
            </h:commandButton>


        </h:form>

        <h:form id="game" >
            <b:poll interval="3000"
                    update="@form" />
            
            
            <div id="dealerCards" >
                <table>
                    <tr>

                        <ui:repeat value="#{tableController.table.dealerCards}" var="card">
                            <td>#{card}</td>
                        </ui:repeat>
                    </tr>
                </table>
                <h2>Dealer Cards Value: <h:outputText value="#{tableController.table.dealerNumber}" /></h2>
            </div>

            <table>
                <tr>
                    <ui:repeat value="#{tableController.table.seats}" var="seat">
                        <td style="background-color: green; width: 100px; height:100px;">
                            <table>
                                <tr>
                                    <h:panelGroup rendered="#{seat.player==null}">
                                        <td>
                                            <h:commandButton value="Join Seat">
                                                <f:ajax execute="#{tableController.joinSeat(seat)}" render="@form" />
                                            </h:commandButton>
                                        </td>
                                    </h:panelGroup>
                                    <ui:repeat value="#{seat.hand.playerCards}" var="card">
                                        <td><h:outputText value="#{card}" /></td>
                                    </ui:repeat>
                                    <h:panelGroup rendered="#{tableController.playerIsInSeat(seat)}">
                                        <h:commandButton value="Leave Seat" >
                                            <f:ajax execute="#{tableController.leaveSeat(seat)}" render="@form"/>
                                        </h:commandButton>
                                    </h:panelGroup>

                                </tr>
                            </table>
                        </td>
                    </ui:repeat>
                    <h:panelGroup rendered="#{seat.hand!=null}">
                        <h2>Player Cards Value: <h:outputText value="#{hand.playerNumber}" /></h2>
                    </h:panelGroup>

                </tr>
            </table>
            <h:outputText value="#{tableController.table.seats.size()}" />
        </h:form>


        <h:form id="gameMessages" >

            <table>

                <ui:repeat value="#{tableController.table.gameMessages}" var="message">
                    <tr>
                        <td>
                            <h:outputText value="#{message}" />
                        </td>
                    </tr>
                </ui:repeat>
                <tr>
                    <td>
                        <h:inputText value="#{tableController.gameMessage}" />            
                    </td>

                    <td>
                        <h:commandButton id="sendMessage" value="Send Message" action="#{tableController.sendGameMessage()}" >
                            <f:ajax execute="@form" render="@form" />

                        </h:commandButton>            

                    </td>
                </tr>
            </table>


        </h:form>


    </h:body>
</html>